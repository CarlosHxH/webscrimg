<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Scraper de Imagens</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      margin: 20px;
    }

    h1 {
      margin-bottom: 10px;
    }

    .search-box {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .search-box input {
      flex: 1;
      padding: 10px;
      font-size: 16px;
    }

    .search-box button {
      padding: 10px 16px;
      font-size: 16px;
      cursor: pointer;
    }

    .engine {
      margin-bottom: 40px;
    }

    .engine h2 {
      margin-bottom: 10px;
      color: #333;
    }

    .error {
      color: red;
      font-size: 14px;
    }

    .images {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 10px;
    }

    .images img {
      width: 100%;
      height: 180px;
      object-fit: cover;
      border-radius: 6px;
      background: #ddd;
    }
  </style>
</head>
<body>

<h1>Resultados do Scraper</h1>

<div class="search-box">
  <input
    type="text"
    id="searchInput"
    placeholder="Digite o que deseja buscar..."
    value="Pneu Firestone F600 Aro 14 175/65 R14"
  />
  <button onclick="search()">Buscar</button>
</div>

<div id="results">Digite uma busca e clique em "Buscar".</div>

<script>
  const BASE_URL = 'http://localhost:3001/api/scrape/all'

  async function search() {
    const query = document.getElementById('searchInput').value.trim()
    const container = document.getElementById('results')

    if (!query) {
      container.innerHTML = '<div class="error">Informe uma busca.</div>'
      return
    }

    container.innerHTML = 'Carregando...'

    const url =
      `${BASE_URL}?query=${encodeURIComponent(query)}&engines=&page=`

    try {
      const response = await fetch(url)
      const data = await response.json()

      container.innerHTML = ''

      data.results.forEach(result => {
        const engineDiv = document.createElement('div')
        engineDiv.className = 'engine'

        const title = document.createElement('h2')
        title.textContent = `Engine: ${result.engine}`
        engineDiv.appendChild(title)

        if (result.error) {
          const error = document.createElement('div')
          error.className = 'error'
          error.textContent = result.error
          engineDiv.appendChild(error)
          container.appendChild(engineDiv)
          return
        }

        if (!result.images || result.images.length === 0) {
          const empty = document.createElement('div')
          empty.className = 'error'
          empty.textContent = 'Nenhuma imagem encontrada.'
          engineDiv.appendChild(empty)
          container.appendChild(engineDiv)
          return
        }

        const imagesDiv = document.createElement('div')
        imagesDiv.className = 'images'

        result.images.forEach(img => {
          const image = document.createElement('img')
          image.src = img.thumbnail || img.url
          image.alt = result.engine
          imagesDiv.appendChild(image)
        })

        engineDiv.appendChild(imagesDiv)
        container.appendChild(engineDiv)
      })
    } catch (err) {
      container.innerHTML =
        `<div class="error">Erro ao consumir API: ${err.message}</div>`
    }
  }

  // Enter para buscar
  document.getElementById('searchInput').addEventListener('keydown', e => {
    if (e.key === 'Enter') search()
  })
</script>

</body>
</html>
